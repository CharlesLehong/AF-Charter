<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<div id="data">
    {"type":"sankey","data":[{"name":"Current","items":[{"name":"ABC retirement fund","value":80000,"to":["2-1","2-0"]},{"name":"Sanlam retirement annuity","value":340000,"to":["1-0"]},{"name":"Old mutual retirement annuity","value":80000,"to":["1-0"]},{"name":"Unity trust","value":410000,"to":["1-0"]}]},{"name":"Joins","items":[{"name":"#","value":900000,"to":["2-1"]}]},{"name":"Recommended","items":[{"name":"AF investments","value":800000,"to":["3-0"]},{"name":"First National Bank","value":1670000,"to":["3-1","3-2","3-3","3-4","3-5"]}]},{"name":"Goals","items":[{"name":"Future Goals","value":100000},{"name":"Clear home loan","value":1100000},{"name":"Pay off student loan","value":100000},{"name":"Emergency fund setup","value":300000},{"name":"Linda's car","value":120000},{"name":"Linda's university ba...","value":50000}]}]}

</div>
<div id="chart" style="width: 900px;height: 500px;"></div>

</body>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    /*
    *
    * */
    let levels = JSON.parse(document.querySelector("#data").innerText);

    google.charts.load('current', {packages:[ levels.type.toString().toLowerCase()==='sankey'?'sankey':'corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function sankeyData(){
        let d = []
        levels.data.forEach((l)=>{
            l.items.forEach((i)=>{
                if('to' in i){
                    i.to.forEach((t)=>{
                        let items = t.split("-");
                        let to = levels.data[parseInt(items[0])].items[parseInt(items[1])]
                        let r = [i.name,to.name,levels.data.length===parseInt(items[0])+1? to.value: i.value]
                        d.push(r)
                    })
                }
            })
        })
        return d;
    }

    function drawChart() {

        let data;
        if(levels['type'].toString().toLowerCase()=="sankey"){
            data = new google.visualization.DataTable();
            data.addColumn('string', 'From');
            data.addColumn('string', 'To');
            data.addColumn('number', 'Amount (ZAR)');
            data.addRows(sankeyData());
            var options = {
                width: 900,
                'allowHtml':true,
                sankey: {
                    node: {
                        nodePadding: 10
                    }
                }
            };
            var chart = new google.visualization.Sankey(document.getElementById('chart'));
        }else{
            data = google.visualization.arrayToDataTable();
            switch (levels['type'].toString().toLowerCase()) {
                case 'piechart':

                    options = {}
                    break;
                default:


            }
        }
        // Create the chart.

        // Draw the chart, setting the allowHtml option to true for the tooltips.
        chart.draw(data, options);
    }
</script>
</html>